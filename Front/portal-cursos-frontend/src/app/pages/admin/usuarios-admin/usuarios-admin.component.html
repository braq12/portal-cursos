<div class="p-3">
    <!-- Toolbar / Título -->
    <p-toolbar styleClass="mb-3 border-round surface-card shadow-1">
      <div class="p-toolbar-group-left">
        <h2 class="m-0">Usuarios</h2>
      </div>
    </p-toolbar>
  
    <div class="grid">
      <!-- Card: Crear usuario -->
      <div class="col-12 lg:col-4">
        <p-card header="Crear usuario" styleClass="shadow-2 border-round-lg">
            <form [formGroup]="form" (ngSubmit)="crearUsuario()" class="p-fluid">
          
              <!-- Fila 1: Nombre / Correo -->
              <div class="formgrid grid">
                <div class="field col-12 md:col-6">
                  <label for="nombre" class="font-semibold">Nombre *</label>
                  <input id="nombre" type="text" pInputText formControlName="nombre" placeholder="Nombre completo" class="w-full"/>
                  <small class="p-error" *ngIf="form.controls['nombre'].touched && form.controls['nombre'].invalid">
                    Ingresa un nombre válido.
                  </small>
                </div>
          
                <div class="field col-12 md:col-6">
                  <label for="correo" class="font-semibold">Correo *</label>
                  <input id="correo" type="email" pInputText formControlName="correo" placeholder="correo@dominio.com" class="w-full"/>
                  <small class="p-error" *ngIf="form.controls['correo'].touched && form.controls['correo'].invalid">
                    Correo inválido.
                  </small>
                </div>
              </div>
          
              <!-- Fila 2: Rol / Clave -->
              <div class="formgrid grid">
                <div class="field col-12 md:col-6">
                  <label for="rol" class="font-semibold">Rol *</label>
                  <p-dropdown id="rol" formControlName="rol"
                              [options]="roles" optionLabel="label" optionValue="value"
                              placeholder="Seleccione" class="w-full"></p-dropdown>
                  <small class="p-error" *ngIf="form.controls['rol'].touched && form.controls['rol'].invalid">
                    Selecciona un rol.
                  </small>
                </div>
          
                <div class="field col-12 md:col-6">
                    <label for="clave" class="font-semibold">Clave *</label>
                    <p-password
                      id="clave"
                      formControlName="clave"
                      [feedback]="false"
                      toggleMask
                      styleClass="w-full"          
                      inputStyleClass="w-full"     
                      placeholder="Mínimo 6 caracteres">
                    </p-password>
                    <small class="p-error" *ngIf="form.controls['clave'].touched && form.controls['clave'].invalid">
                      La clave debe tener al menos 6 caracteres.
                    </small>
                  </div>
              </div>
          
              <!-- Botones -->
              <div class="flex gap-2 mt-2">
                <button pButton type="submit" label="Crear" class="p-button-success"
                        [disabled]="form.invalid || creando()"></button>
                <button pButton type="button" label="Limpiar"
                        class="p-button-secondary p-button-outlined"
                        (click)="form.reset({ rol: 'USUARIO' })"></button>
              </div>
          
            </form>
          </p-card>
          
      </div>
  
      <!-- Tabla de usuarios -->
      <div class="col-12 lg:col-8">
        <p-card header="Listado de usuarios" styleClass="shadow-2 border-round-lg">
          <div class="flex justify-content-between align-items-center mb-3 gap-2">
            <span class="text-500">Total: {{ usuarios.length }}</span>
          </div>
  
          <p-table
            [value]="usuarios"
            [paginator]="true" [rows]="10"
            [rowsPerPageOptions]="[10,20,50]"
            [loading]="loadingLista()"
            [globalFilterFields]="['nombre','correo','rol']"
            [sortField]="'fechaCreacion'" [sortOrder]="-1"
            [tableStyle]="{ 'min-width': '40rem' }"
            [filterDelay]="0"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="Mostrando {first} - {last} de {totalRecords}"
          >
            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="nombre">Nombre <p-sortIcon field="nombre"/></th>
                <th pSortableColumn="correo">Correo <p-sortIcon field="correo"/></th>
                <th pSortableColumn="rol">Rol <p-sortIcon field="rol"/></th>
                <th pSortableColumn="fechaCreacion">Creado <p-sortIcon field="fechaCreacion"/></th>
              </tr>
            </ng-template>
  
            <ng-template pTemplate="body" let-u>
              <tr>
                <td>{{ u.nombre }}</td>
                <td>{{ u.correo }}</td>
                <td><p-tag [value]="u.rol" [severity]="getSeverity(u.rol)"></p-tag></td>
                <td>{{ u.fechaCreacion | date:'short' }}</td>
              </tr>
            </ng-template>
  
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="4" class="text-center text-500">No hay usuarios para mostrar.</td>
              </tr>
            </ng-template>
          </p-table>
        </p-card>
      </div>
    </div>
  </div>
  